trigger:
  - main

pr:
  - main

resources:
  repositories:
    - repository: boostsecurityio
      endpoint: boostsecurityio
      name: boostsecurityio/boostsec-scanner-azure
      ref: refs/tags/v4
      type: github

variables:
  - group: boost-prod
  - name: api_token
    value: $[variables.BOOST_API_TOKEN]

steps:
  - checkout: self
    clean: true
    fetchDepth: 1
    persistCredentials: true

  - task: BoostSecurityScan@0
    inputs:
      api_token: $(api_token)
      registry_module: boostsecurityio/native-scanner

  - template: templates/scanner.yaml
    parameters:
      api_enabled: false
      api_token: $(api_token)
      registry_module: boostsecurityio/native-scanner
